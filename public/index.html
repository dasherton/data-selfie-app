<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Data Selfie App</title>
</head>
<body>
	<h1>This is a data selfie application</h1>
	<h2>Location:</h2>
	<p>Latitude: <span id="latitude">&deg;</span></p>
	<p>Longitude: <span id="longitude">&deg;</span></p>
	<button id="submit">Submit</button>

	<script>
		function displayCoordinates(coords) {
			document.getElementById('latitude').textContent = coords.latitude;
			document.getElementById('longitude').textContent = coords.longitude;
		}

		async function sendCoordinatesToServer(coords) {
			const data = {
				'latitude': coords.latitude,
				'longitude': coords.longitude
			};

			const options = {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(data)
			};

			const response = await fetch('/api', options);
			const json = await response.json();
			console.log(json);
		}
		
		if('geolocation' in Navigator) {
			console.error('Geolocation NOT available!');
		} else {
			console.log('Geolocation available!');
			navigator.geolocation.getCurrentPosition( (pos) => {
				displayCoordinates(pos.coords);
			})
		}

		document.getElementById('submit').addEventListener('click', (e) => {
			navigator.geolocation.getCurrentPosition( (pos) => {
				sendCoordinatesToServer(pos.coords);
			});
		})
	</script>
</body>
</html>
